const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Card-DkymZBL9.js","assets/index-DLZBvp8a.js","assets/index-DoV_zDQS.css","assets/Card-C-UUnEqF.css"])))=>i.map(i=>d[i]);
import{d as se,u as ae,o as g,c as I,w as T,a as N,b as C,e as f,T as ne,_ as oe,f as re,g as le,h as J,i as E,j as Q,t as S,k as V,F as R,r as z,l as X,m as ce,n as Y,p as ue,q as ie,s as k,v as O,x as he}from"./index-DLZBvp8a.js";import{g as de,a as fe,b as me,n as b,c as pe,S as ve,_ as ge}from"./textNormalization-CEnatW11.js";function L(r,$,c="",m=0,u=new WeakSet){const p=new Map;if(m>10||r==null)return p;if(typeof r=="object"&&!Array.isArray(r)){if(u.has(r))return p;u.add(r)}if(typeof r=="string"){const n=b(r),i=b($),x=n.toLowerCase();let a=0,h=0;const v=[];for(;(a=x.indexOf(i,a))!==-1;)h++,v.length<3&&v.push(pe(n,a,i.length)),a+=i.length;h>0&&p.set(c||"root",{path:c||"root",snippets:v,count:h})}else if(typeof r=="number"||typeof r=="boolean"){const n=String(r);n.toLowerCase().includes($)&&p.set(c||"root",{path:c||"root",snippets:[n],count:1})}else if(Array.isArray(r))r.forEach((n,i)=>{L(n,$,`${c}[${i}]`,m+1,u).forEach((a,h)=>{p.set(h,a)})});else if(typeof r=="object")for(const[n,i]of Object.entries(r))L(i,$,c?`${c}.${n}`:n,m+1,u).forEach((a,h)=>{p.set(h,a)});return p}async function _e(r,$,c,m,u,p,n=!1){const i=r.trim();if(!i)return{success:!0,results:[],totalItems:0};if(!p&&m.length===0&&u.length===0)return{success:!1,results:[],totalItems:null,error:"Please select at least one search scope (Blog, Page Type, or Collection Key)"};const x=i.toLowerCase(),a=[];let h=!1;try{const v=[],_=[];if(m.length>0)for(const o of m)try{(await de({token:$,pageType:o,preview:c})).forEach(M=>{_.push({data:M,sourceType:o})}),h=!0}catch(d){console.error(`Failed to fetch page type "${o}":`,d),a.push(`Page Type: ${o}`)}if(p)try{(await fe({token:$,preview:c})).forEach(d=>{_.push({data:d,sourceType:"Blog"})}),h=!0}catch(o){console.error("Failed to fetch Blog posts:",o),a.push("Blog")}if(u.length>0)for(const o of u)try{(await me({token:$,collectionType:o,preview:c})).forEach(M=>{_.push({data:M,sourceType:o})}),h=!0}catch(d){console.error(`Failed to fetch collection "${o}":`,d),a.push(`Collection: ${o}`)}if(!h)return{success:!1,results:[],totalItems:null,failedScopes:a,error:"Failed to fetch all selected scopes. Check console for details."};for(const{data:o,sourceType:d}of _){const M=L(o,x);if(M.size>0===!n){const w=o;if(n)v.push({title:w.name||w.title||w.slug||"Untitled",slug:w.slug||"N/A",sourceType:d,matches:[]});else{const P=Array.from(M.values()).map(l=>l.count>1?{path:`${l.path} (${l.count} occurrences)`,value:l.snippets[0]||"",count:l.count}:{path:l.path,value:l.snippets[0]||"",count:l.count}).filter(l=>l.value&&l.value.trim().length>0);P.length>0&&v.push({title:w.name||w.title||w.slug||"Untitled",slug:w.slug||"N/A",sourceType:d,matches:P})}}}return v.sort((o,d)=>o.slug.localeCompare(d.slug)),{success:!0,results:v,totalItems:_.length,failedScopes:a.length>0?a:void 0}}catch(v){return{success:!1,results:[],totalItems:null,failedScopes:a,error:v.message}}}const ye={class:"search-content__negation-section"},Se={key:4,class:"search-content__loading"},$e={key:5,id:"resultsContainer",class:"search-content__results-container"},Te={class:"search-content__summary","aria-live":"polite","aria-atomic":"true"},ke={class:"results-list"},we={class:"search-content__result-header"},Ce={class:"search-content__result-header-left"},Me={class:"search-content__result-title-wrapper"},xe={class:"search-content__result-title"},Ae={class:"search-content__result-slug"},Ee={class:"search-content__matches-list"},Ve={class:"search-content__match-path"},Ie=["innerHTML"],Ne={key:6,class:"search-content__failed-items"},Pe=se({__name:"SearchContent",setup(r){const $=ue(()=>ie(()=>import("./Card-DkymZBL9.js"),__vite__mapDeps([0,1,2,3]))),c=ae(),m=k(""),u=k(!1),p=k(!1),n=k(!1),i=k(""),x=k("info"),a=k([]),h=k(null),v=k(null),_=k([]),o=k(0),d=O(()=>a.value.length>0);function M(s,e,t){return s===1?e:t}function U(s){const e=document.createElement("div");return e.textContent=s,e.innerHTML}function w(s){const e={"'":["'","&apos;","&#39;","‘","’"],'"':['"',"&quot;","“","”"],"-":["-","&ndash;","&mdash;","–","—"],"£":["£","&pound;"],"€":["€","&euro;"],"&":["&","&amp;"],"<":["<","&lt;"],">":[">","&gt;"]," ":[" ","&nbsp;"," "]};return e[s]?`(?:${e[s].map(y=>y.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).join("|")})`:s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function H(s,e){const t=U(s),y=b(e.trim()),A=Array.from(y).map(w).join(""),B=new RegExp(`(${A})`,"gi");return t.replace(B,"<mark>$1</mark>")}function P(){a.value=[],h.value=null,v.value=null,_.value=[],i.value="",m.value="",p.value=!1}function l(s,e="info",t=!1){i.value=s,x.value=e,n.value=t}function Z(s){return s.sourceType==="Blog"?"Blog":`${s.sourceType}`}async function q(){const s=c.token,e=m.value.trim();if(a.value=[],h.value=null,v.value=null,_.value=[],i.value="",!s){l("Please enter your API token","error");return}if(p.value=!m.value,!p.value){n.value=!0,l("Searching...","info",!0);try{const t=await _e(e,s,c.includePreview,c.selectedScopes.pageTypes,c.selectedScopes.collectionKeys,c.selectedScopes.blog,u.value);if(!t.success){h.value=t.error,v.value=t.error,_.value=t.failedScopes||[],l(t.error,"error");return}o.value=t.totalItems,_.value=t.failedScopes||[],t.results.length===0?l(`No items ${u.value?"NOT":""} containing "${e}" found in ${t.totalItems} selected items`,"info",!1):(l(`Found ${t.results.length} items ${u.value?"NOT":""} containing "${e}" out of ${t.totalItems} total selected items`,"success",!1),a.value=t.results)}catch(t){l(`Error: ${t.message}`,"error")}finally{n.value=!1}}}const j=O(()=>a.value.reduce((s,e)=>s+e.matches.reduce((t,y)=>t+(y.count||1),0),0)),D=O(()=>{const s=new Map;return a.value.forEach(e=>{const t=e.sourceType||"Unknown",y=e.matches.reduce((F,A)=>F+(A.count||1),0);s.set(t,(s.get(t)||0)+y)}),Array.from(s.entries()).map(([e,t])=>({scope:e,count:t})).sort((e,t)=>t.count-e.count)}),ee=O(()=>{const s=j.value;if(D.value.length===0)return"";const e=D.value.map(({scope:t,count:y})=>`${y} in ${t}`).join(", ");return`${s} ${M(s,"match","matches")}: ${e}`});function K(s){return s.matches.reduce((e,t)=>e+(t.count||1),0)}return(s,e)=>(g(),I(ge,{title:"Search Content",description:`Search through pages, blog posts, or collections for content ${u.value?"NOT":""} matching your search term. Results will highlight exactly where matches were ${u.value?"NOT":""} found.`},{default:T(()=>[N(ve,{disabled:d.value,"aria-context":"search"},{legend:T(()=>[...e[4]||(e[4]=[C("Search Scopes",-1)])]),_:1},8,["disabled"]),f("div",ye,[e[5]||(e[5]=f("div",{class:"search-content__negation-label"},"Search Mode",-1)),N(ne,{id:"search-mode-toggle",modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=t=>u.value=t),disabled:d.value,"off-label":"Include matches (show items containing search term)","on-label":"Exclude matches (show items NOT containing search term)"},null,8,["modelValue","disabled"])]),N(oe,{id:"search-content-search-term",type:"text",required:!0,modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=t=>m.value=t),onKeypress:re(q,["enter"])},le({label:T(()=>[e[6]||(e[6]=C("Search Term",-1))]),_:2},[p.value?{name:"error",fn:T(()=>[e[7]||(e[7]=C("Please enter a search term",-1))]),key:"0"}:void 0]),1032,["modelValue"]),!d.value&&!n.value?(g(),I(J,{key:0,onClick:q},{default:T(()=>[...e[8]||(e[8]=[C(" Search ",-1)])]),_:1})):E("",!0),d.value||i.value?(g(),I(J,{key:1,type:"reset",status:"tertiary",onClick:P},{default:T(()=>[...e[9]||(e[9]=[C(" Reset ",-1)])]),_:1})):E("",!0),i.value&&!n.value?(g(),I(Q,{key:2,status:x.value,role:"alert"},{default:T(()=>[f("div",null,S(i.value),1)]),_:1},8,["status"])):E("",!0),_.value.length>0&&!n.value?(g(),I(Q,{key:3,status:"warning"},{default:T(()=>[e[10]||(e[10]=f("strong",null,"Partial failure:",-1)),C(" Failed to fetch "+S(_.value.join(", "))+". Showing results from successfully fetched scopes only. ",1)]),_:1})):E("",!0),n.value?(g(),V("div",Se,[(g(),V(R,null,z(3,t=>N(X($),{key:t,skeleton:!0,class:"search-content__skeleton-card"})),64))])):E("",!0),a.value.length>0&&!n.value?(g(),V("div",$e,[f("div",Te,[C(" Found "+S(ee.value)+" "+S(u.value?"NOT":"")+' containing "',1),f("strong",null,S(m.value),1),e[11]||(e[11]=C('" ',-1))]),f("div",ke,[(g(!0),V(R,null,z(a.value,(t,y,F,A)=>{const B=[t,m.value];if(A&&A.key===y&&ce(A,B))return A;const W=(g(),I(X($),{key:y,class:"search-content__result-card"},{default:T(()=>[f("div",we,[f("div",Ce,[f("div",Me,[N(Y,{size:"small"},{default:T(()=>[C(S(Z(t)),1)]),_:2},1024),f("span",xe,S(t.title),1)]),f("div",Ae,S(t.slug),1)]),N(Y,{size:"medium",class:"search-content__match-count"},{default:T(()=>[C(S(K(t))+" "+S(M(K(t),"match","matches")),1)]),_:2},1024)]),f("div",Ee,[(g(!0),V(R,null,z(t.matches,(G,te)=>(g(),V("div",{key:te,class:"search-content__match-item"},[f("div",Ve,S(G.path),1),f("div",{class:"search-content__match-value",innerHTML:H(G.value,m.value)},null,8,Ie)]))),128))])]),_:2},1024));return W.memo=B,W},e,2),128))])])):E("",!0),h.value?(g(),V("div",Ne,[e[12]||(e[12]=f("h4",{class:"search-content__failed-items-title"},"⚠️ Failed to retrieve content",-1)),f("p",null,S(v.value),1)])):E("",!0)]),_:1},8,["description"]))}}),Fe=he(Pe,[["__scopeId","data-v-96b51ec8"]]);export{Fe as default};
