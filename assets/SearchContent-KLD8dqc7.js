const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Card-FtgIa-Wo.js","assets/index-DGmZdbMc.js","assets/index-CtDfAwOd.css","assets/Card-C-UUnEqF.css"])))=>i.map(i=>d[i]);
import{d as se,u as ae,o as g,c as I,w as k,a as N,b as $,e as l,T as ne,f as oe,_ as re,g as le,h as J,i as V,j as Q,t as _,k as x,F as B,r as R,l as X,m as ce,n as Y,p as ue,q as ie,s as C,v as de,x as F,y as he}from"./index-DGmZdbMc.js";import{g as fe,a as me,b as pe,n as z,c as ve,S as ge,_ as _e}from"./textNormalization-TLjFJBoo.js";function L(c,T,i="",d=0,o=new WeakSet){const m=new Map;if(d>10||c==null)return m;if(typeof c=="object"&&!Array.isArray(c)){if(o.has(c))return m;o.add(c)}if(typeof c=="string"){const n=z(c),p=z(T),A=n.toLowerCase();let a=0,h=0;const v=[];for(;(a=A.indexOf(p,a))!==-1;)h++,v.length<3&&v.push(ve(n,a,p.length)),a+=p.length;h>0&&m.set(i||"root",{path:i||"root",snippets:v,count:h})}else if(typeof c=="number"||typeof c=="boolean"){const n=String(c);n.toLowerCase().includes(T)&&m.set(i||"root",{path:i||"root",snippets:[n],count:1})}else if(Array.isArray(c))c.forEach((n,p)=>{L(n,T,`${i}[${p}]`,d+1,o).forEach((a,h)=>{m.set(h,a)})});else if(typeof c=="object")for(const[n,p]of Object.entries(c))L(p,T,i?`${i}.${n}`:n,d+1,o).forEach((a,h)=>{m.set(h,a)});return m}async function ye(c,T,i,d,o,m,n=!1){const p=c.trim();if(!p)return{success:!0,results:[],totalItems:0};if(!m&&d.length===0&&o.length===0)return{success:!1,results:[],totalItems:null,error:"Please select at least one search scope (Blog, Page Type, or Collection Key)"};const A=p.toLowerCase(),a=[];let h=!1;try{const v=[],y=[];if(d.length>0)for(const r of d)try{(await fe({token:T,pageType:r,preview:i})).forEach(w=>{y.push({data:w,sourceType:r})}),h=!0}catch(f){console.error(`Failed to fetch page type "${r}":`,f),a.push(`Page Type: ${r}`)}if(m)try{(await me({token:T,preview:i})).forEach(f=>{y.push({data:f,sourceType:"Blog"})}),h=!0}catch(r){console.error("Failed to fetch Blog posts:",r),a.push("Blog")}if(o.length>0)for(const r of o)try{(await pe({token:T,collectionType:r,preview:i})).forEach(w=>{y.push({data:w,sourceType:r})}),h=!0}catch(f){console.error(`Failed to fetch collection "${r}":`,f),a.push(`Collection: ${r}`)}if(!h)return{success:!1,results:[],totalItems:null,failedScopes:a,error:"Failed to fetch all selected scopes. Check console for details."};for(const{data:r,sourceType:f}of y){const w=L(r,A);if(w.size>0===!n){const M=r;if(n)v.push({title:M.name||M.title||M.slug||"Untitled",slug:M.slug||"N/A",sourceType:f,matches:[]});else{const O=Array.from(w.values()).map(u=>u.count>1?{path:`${u.path} (${u.count} occurrences)`,value:u.snippets[0]||"",count:u.count}:{path:u.path,value:u.snippets[0]||"",count:u.count}).filter(u=>u.value&&u.value.trim().length>0);O.length>0&&v.push({title:M.name||M.title||M.slug||"Untitled",slug:M.slug||"N/A",sourceType:f,matches:O})}}}return v.sort((r,f)=>r.slug.localeCompare(f.slug)),{success:!0,results:v,totalItems:y.length,failedScopes:a.length>0?a:void 0}}catch(v){return{success:!1,results:[],totalItems:null,failedScopes:a,error:v.message}}}const Se={class:"search-content__negation-section"},$e={key:2,class:"search-content__loading"},Te={key:3,id:"resultsContainer",class:"search-content__results-container"},ke={class:"search-content__summary","aria-live":"polite","aria-atomic":"true"},we={class:"search-content__results-list"},Me={class:"search-content__result-header"},Ce={class:"search-content__result-header-left"},xe={class:"search-content__result-title-wrapper"},Ae={class:"search-content__result-title"},Ee={class:"search-content__result-slug"},Ve={class:"search-content__matches-list"},Ie={class:"search-content__match-path"},Ne=["innerHTML"],Pe={key:4,class:"search-content__failed-items"},Be=se({__name:"SearchContent",setup(c){const T=ue(()=>ie(()=>import("./Card-FtgIa-Wo.js"),__vite__mapDeps([0,1,2,3]))),i=ae(),d=C(""),o=C(!1),m=C(!1),n=C(!1),p=C(""),A=C("info"),a=de([]),h=C(null),v=C(null),y=C([]),r=C(0),f=F(()=>a.value.length>0);function w(s,e,t){return s===1?e:t}function U(s){const e=document.createElement("div");return e.textContent=s,e.innerHTML}function M(s){const e={"'":["'","&apos;","&#39;","‘","’"],'"':['"',"&quot;","“","”"],"-":["-","&ndash;","&mdash;","–","—"],"£":["£","&pound;"],"€":["€","&euro;"],"&":["&","&amp;"],"<":["<","&lt;"],">":[">","&gt;"]," ":[" ","&nbsp;"," "]};return e[s]?`(?:${e[s].map(S=>S.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).join("|")})`:s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function H(s,e){const t=U(s),S=z(e.trim()),E=Array.from(S).map(M).join(""),b=new RegExp(`(${E})`,"gi");return t.replace(b,"<mark>$1</mark>")}function O(){a.value=[],h.value=null,v.value=null,y.value=[],p.value="",d.value="",m.value=!1}function u(s,e="info",t=!1){p.value=s,A.value=e,n.value=t}function Z(s){return s.sourceType==="Blog"?"Blog":`${s.sourceType}`}async function j(){const s=i.token,e=d.value.trim();if(a.value=[],h.value=null,v.value=null,y.value=[],p.value="",!s){u("Please enter your API token","error");return}if(m.value=!d.value,!m.value){n.value=!0,u("Searching...","info",!0);try{const t=await ye(e,s,i.includePreview,i.selectedScopes.pageTypes,i.selectedScopes.collectionKeys,i.selectedScopes.blog,o.value);if(!t.success){h.value=t.error,v.value=t.error,y.value=t.failedScopes||[],u(t.error,"error");return}r.value=t.totalItems,y.value=t.failedScopes||[],t.results.length===0?u(`No items ${o.value?"NOT":""} containing "${e}" found in ${t.totalItems} selected items`,"info",!1):(u(`Found ${t.results.length} items ${o.value?"NOT":""} containing "${e}" out of ${t.totalItems} total selected items`,"success",!1),a.value=t.results)}catch(t){u(`Error: ${t.message}`,"error")}finally{n.value=!1}}}const ee=F(()=>a.value.reduce((s,e)=>s+e.matches.reduce((t,S)=>t+(S.count||1),0),0)),q=F(()=>{const s=new Map;return a.value.forEach(e=>{const t=e.sourceType||"Unknown",S=o.value?1:e.matches.reduce((P,E)=>P+(E.count||1),0);s.set(t,(s.get(t)||0)+S)}),Array.from(s.entries()).map(([e,t])=>({scope:e,count:t})).sort((e,t)=>t.count-e.count)}),D=F(()=>{const s=o.value?a.value.length:ee.value;if(q.value.length===0)return"";const e=q.value.map(({scope:S,count:P})=>`${P} in ${S}`).join(", "),t=o.value?w(s,"item","items"):w(s,"match","matches");return`${s} ${t}: ${e}`});function W(s){return s.matches.reduce((e,t)=>e+(t.count||1),0)}return(s,e)=>(g(),I(_e,{title:"Search Content",description:`Search through pages, blog posts, or collections for content ${o.value?"NOT":""} matching your search term. Results will highlight exactly where matches were ${o.value?"NOT":""} found.`},{default:k(()=>[N(ge,{disabled:f.value,"aria-context":"search"},{legend:k(()=>[...e[4]||(e[4]=[$("Search Scopes",-1)])]),_:1},8,["disabled"]),l("div",Se,[e[5]||(e[5]=l("div",{class:"search-content__negation-label"},"Search Mode",-1)),N(ne,{id:"search-mode-toggle",modelValue:o.value,"onUpdate:modelValue":e[0]||(e[0]=t=>o.value=t),disabled:f.value,"off-label":"Include matches (show items containing search term)","on-label":"Exclude matches (show items NOT containing search term)"},null,8,["modelValue","disabled"])]),l("form",{class:"search-content__form",novalidate:"",onSubmit:oe(j,["prevent"])},[N(re,{id:"search-content-search-term",type:"text",required:!0,disabled:f.value,modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=t=>d.value=t)},le({label:k(()=>[e[6]||(e[6]=$("Search Term",-1))]),_:2},[m.value?{name:"error",fn:k(()=>[e[7]||(e[7]=$("Please enter a search term",-1))]),key:"0"}:void 0]),1032,["disabled","modelValue"]),!f.value&&!n.value?(g(),I(J,{key:0,type:"submit"},{default:k(()=>[...e[8]||(e[8]=[$(" Search ",-1)])]),_:1})):V("",!0),a.value.length>0?(g(),I(J,{key:1,type:"reset",status:"tertiary",onClick:O},{default:k(()=>[...e[9]||(e[9]=[$(" Reset ",-1)])]),_:1})):V("",!0)],32),p.value&&!n.value?(g(),I(Q,{key:0,status:A.value,role:"alert"},{default:k(()=>[l("div",null,_(p.value),1)]),_:1},8,["status"])):V("",!0),y.value.length>0&&!n.value?(g(),I(Q,{key:1,status:"warning"},{default:k(()=>[e[10]||(e[10]=l("strong",null,"Partial failure:",-1)),$(" Failed to fetch "+_(y.value.join(", "))+". Showing results from successfully fetched scopes only. ",1)]),_:1})):V("",!0),n.value?(g(),x("div",$e,[(g(),x(B,null,R(3,t=>N(X(T),{key:t,skeleton:!0,class:"search-content__skeleton-card"})),64))])):V("",!0),a.value.length>0&&!n.value?(g(),x("div",Te,[l("div",ke,[o.value?(g(),x(B,{key:0},[$(" Found "+_(D.value)+' NOT containing "',1),l("strong",null,_(d.value),1),e[11]||(e[11]=$('" ',-1))],64)):(g(),x(B,{key:1},[$(" Found "+_(D.value)+' containing "',1),l("strong",null,_(d.value),1),e[12]||(e[12]=$('" ',-1))],64))]),l("div",we,[(g(!0),x(B,null,R(a.value,(t,S,P,E)=>{const b=[t,d.value];if(E&&E.key===S&&ce(E,b))return E;const K=(g(),I(X(T),{key:S,class:"search-content__result-card"},{default:k(()=>[l("div",Me,[l("div",Ce,[l("div",xe,[N(Y,{size:"small"},{default:k(()=>[$(_(Z(t)),1)]),_:2},1024),l("span",Ae,_(t.title),1)]),l("div",Ee,_(t.slug),1)]),N(Y,{size:"medium",class:"search-content__match-count"},{default:k(()=>[$(_(W(t))+" "+_(w(W(t),"match","matches")),1)]),_:2},1024)]),l("div",Ve,[(g(!0),x(B,null,R(t.matches,(G,te)=>(g(),x("div",{key:te,class:"search-content__match-item"},[l("div",Ie,_(G.path),1),l("div",{class:"search-content__match-value",innerHTML:H(G.value,d.value)},null,8,Ne)]))),128))])]),_:2},1024));return K.memo=b,K},e,2),128))])])):V("",!0),h.value?(g(),x("div",Pe,[e[13]||(e[13]=l("h4",{class:"search-content__failed-items-title"},"⚠️ Failed to retrieve content",-1)),l("p",null,_(v.value),1)])):V("",!0)]),_:1},8,["description"]))}}),Fe=he(Be,[["__scopeId","data-v-81a87ce5"]]);export{Fe as default};
