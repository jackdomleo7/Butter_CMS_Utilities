const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Card-DqtFFe5d.js","assets/index-W3tOi6xs.js","assets/index-CtDfAwOd.css","assets/Card-C-UUnEqF.css"])))=>i.map(i=>d[i]);
import{d as se,u as ae,o as g,c as I,w as T,a as N,b as w,e as c,T as ne,f as oe,_ as re,g as le,h as G,i as E,j as J,t as S,k as V,F as R,r as F,l as Q,m as ce,n as X,p as ue,q as ie,s as M,v as he,x as O,y as de}from"./index-W3tOi6xs.js";import{g as fe,a as me,b as pe,n as z,c as ve,S as ge,_ as _e}from"./textNormalization-CdDZN0cW.js";function L(r,$,u="",f=0,i=new WeakSet){const m=new Map;if(f>10||r==null)return m;if(typeof r=="object"&&!Array.isArray(r)){if(i.has(r))return m;i.add(r)}if(typeof r=="string"){const n=z(r),p=z($),x=n.toLowerCase();let a=0,h=0;const v=[];for(;(a=x.indexOf(p,a))!==-1;)h++,v.length<3&&v.push(ve(n,a,p.length)),a+=p.length;h>0&&m.set(u||"root",{path:u||"root",snippets:v,count:h})}else if(typeof r=="number"||typeof r=="boolean"){const n=String(r);n.toLowerCase().includes($)&&m.set(u||"root",{path:u||"root",snippets:[n],count:1})}else if(Array.isArray(r))r.forEach((n,p)=>{L(n,$,`${u}[${p}]`,f+1,i).forEach((a,h)=>{m.set(h,a)})});else if(typeof r=="object")for(const[n,p]of Object.entries(r))L(p,$,u?`${u}.${n}`:n,f+1,i).forEach((a,h)=>{m.set(h,a)});return m}async function ye(r,$,u,f,i,m,n=!1){const p=r.trim();if(!p)return{success:!0,results:[],totalItems:0};if(!m&&f.length===0&&i.length===0)return{success:!1,results:[],totalItems:null,error:"Please select at least one search scope (Blog, Page Type, or Collection Key)"};const x=p.toLowerCase(),a=[];let h=!1;try{const v=[],_=[];if(f.length>0)for(const o of f)try{(await fe({token:$,pageType:o,preview:u})).forEach(C=>{_.push({data:C,sourceType:o})}),h=!0}catch(d){console.error(`Failed to fetch page type "${o}":`,d),a.push(`Page Type: ${o}`)}if(m)try{(await me({token:$,preview:u})).forEach(d=>{_.push({data:d,sourceType:"Blog"})}),h=!0}catch(o){console.error("Failed to fetch Blog posts:",o),a.push("Blog")}if(i.length>0)for(const o of i)try{(await pe({token:$,collectionType:o,preview:u})).forEach(C=>{_.push({data:C,sourceType:o})}),h=!0}catch(d){console.error(`Failed to fetch collection "${o}":`,d),a.push(`Collection: ${o}`)}if(!h)return{success:!1,results:[],totalItems:null,failedScopes:a,error:"Failed to fetch all selected scopes. Check console for details."};for(const{data:o,sourceType:d}of _){const C=L(o,x);if(C.size>0===!n){const k=o;if(n)v.push({title:k.name||k.title||k.slug||"Untitled",slug:k.slug||"N/A",sourceType:d,matches:[]});else{const P=Array.from(C.values()).map(l=>l.count>1?{path:`${l.path} (${l.count} occurrences)`,value:l.snippets[0]||"",count:l.count}:{path:l.path,value:l.snippets[0]||"",count:l.count}).filter(l=>l.value&&l.value.trim().length>0);P.length>0&&v.push({title:k.name||k.title||k.slug||"Untitled",slug:k.slug||"N/A",sourceType:d,matches:P})}}}return v.sort((o,d)=>o.slug.localeCompare(d.slug)),{success:!0,results:v,totalItems:_.length,failedScopes:a.length>0?a:void 0}}catch(v){return{success:!1,results:[],totalItems:null,failedScopes:a,error:v.message}}}const Se={class:"search-content__negation-section"},$e={key:2,class:"search-content__loading"},Te={key:3,id:"resultsContainer",class:"search-content__results-container"},ke={class:"search-content__summary","aria-live":"polite","aria-atomic":"true"},we={class:"results-list"},Me={class:"search-content__result-header"},Ce={class:"search-content__result-header-left"},xe={class:"search-content__result-title-wrapper"},Ae={class:"search-content__result-title"},Ee={class:"search-content__result-slug"},Ve={class:"search-content__matches-list"},Ie={class:"search-content__match-path"},Ne=["innerHTML"],Pe={key:4,class:"search-content__failed-items"},Be=se({__name:"SearchContent",setup(r){const $=ue(()=>ie(()=>import("./Card-DqtFFe5d.js"),__vite__mapDeps([0,1,2,3]))),u=ae(),f=M(""),i=M(!1),m=M(!1),n=M(!1),p=M(""),x=M("info"),a=he([]),h=M(null),v=M(null),_=M([]),o=M(0),d=O(()=>a.value.length>0);function C(s,e,t){return s===1?e:t}function U(s){const e=document.createElement("div");return e.textContent=s,e.innerHTML}function k(s){const e={"'":["'","&apos;","&#39;","‘","’"],'"':['"',"&quot;","“","”"],"-":["-","&ndash;","&mdash;","–","—"],"£":["£","&pound;"],"€":["€","&euro;"],"&":["&","&amp;"],"<":["<","&lt;"],">":[">","&gt;"]," ":[" ","&nbsp;"," "]};return e[s]?`(?:${e[s].map(y=>y.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).join("|")})`:s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function H(s,e){const t=U(s),y=z(e.trim()),A=Array.from(y).map(k).join(""),B=new RegExp(`(${A})`,"gi");return t.replace(B,"<mark>$1</mark>")}function P(){a.value=[],h.value=null,v.value=null,_.value=[],p.value="",f.value="",m.value=!1}function l(s,e="info",t=!1){p.value=s,x.value=e,n.value=t}function Y(s){return s.sourceType==="Blog"?"Blog":`${s.sourceType}`}async function Z(){const s=u.token,e=f.value.trim();if(a.value=[],h.value=null,v.value=null,_.value=[],p.value="",!s){l("Please enter your API token","error");return}if(m.value=!f.value,!m.value){n.value=!0,l("Searching...","info",!0);try{const t=await ye(e,s,u.includePreview,u.selectedScopes.pageTypes,u.selectedScopes.collectionKeys,u.selectedScopes.blog,i.value);if(!t.success){h.value=t.error,v.value=t.error,_.value=t.failedScopes||[],l(t.error,"error");return}o.value=t.totalItems,_.value=t.failedScopes||[],t.results.length===0?l(`No items ${i.value?"NOT":""} containing "${e}" found in ${t.totalItems} selected items`,"info",!1):(l(`Found ${t.results.length} items ${i.value?"NOT":""} containing "${e}" out of ${t.totalItems} total selected items`,"success",!1),a.value=t.results)}catch(t){l(`Error: ${t.message}`,"error")}finally{n.value=!1}}}const j=O(()=>a.value.reduce((s,e)=>s+e.matches.reduce((t,y)=>t+(y.count||1),0),0)),q=O(()=>{const s=new Map;return a.value.forEach(e=>{const t=e.sourceType||"Unknown",y=e.matches.reduce((b,A)=>b+(A.count||1),0);s.set(t,(s.get(t)||0)+y)}),Array.from(s.entries()).map(([e,t])=>({scope:e,count:t})).sort((e,t)=>t.count-e.count)}),ee=O(()=>{const s=j.value;if(q.value.length===0)return"";const e=q.value.map(({scope:t,count:y})=>`${y} in ${t}`).join(", ");return`${s} ${C(s,"match","matches")}: ${e}`});function D(s){return s.matches.reduce((e,t)=>e+(t.count||1),0)}return(s,e)=>(g(),I(_e,{title:"Search Content",description:`Search through pages, blog posts, or collections for content ${i.value?"NOT":""} matching your search term. Results will highlight exactly where matches were ${i.value?"NOT":""} found.`},{default:T(()=>[N(ge,{disabled:d.value,"aria-context":"search"},{legend:T(()=>[...e[4]||(e[4]=[w("Search Scopes",-1)])]),_:1},8,["disabled"]),c("div",Se,[e[5]||(e[5]=c("div",{class:"search-content__negation-label"},"Search Mode",-1)),N(ne,{id:"search-mode-toggle",modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=t=>i.value=t),disabled:d.value,"off-label":"Include matches (show items containing search term)","on-label":"Exclude matches (show items NOT containing search term)"},null,8,["modelValue","disabled"])]),c("form",{class:"search-content__form",novalidate:"",onSubmit:oe(Z,["prevent"])},[N(re,{id:"search-content-search-term",type:"text",required:!0,disabled:d.value,modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=t=>f.value=t)},le({label:T(()=>[e[6]||(e[6]=w("Search Term",-1))]),_:2},[m.value?{name:"error",fn:T(()=>[e[7]||(e[7]=w("Please enter a search term",-1))]),key:"0"}:void 0]),1032,["disabled","modelValue"]),!d.value&&!n.value?(g(),I(G,{key:0,type:"submit"},{default:T(()=>[...e[8]||(e[8]=[w(" Search ",-1)])]),_:1})):E("",!0),a.value.length>0?(g(),I(G,{key:1,type:"reset",status:"tertiary",onClick:P},{default:T(()=>[...e[9]||(e[9]=[w(" Reset ",-1)])]),_:1})):E("",!0)],32),p.value&&!n.value?(g(),I(J,{key:0,status:x.value,role:"alert"},{default:T(()=>[c("div",null,S(p.value),1)]),_:1},8,["status"])):E("",!0),_.value.length>0&&!n.value?(g(),I(J,{key:1,status:"warning"},{default:T(()=>[e[10]||(e[10]=c("strong",null,"Partial failure:",-1)),w(" Failed to fetch "+S(_.value.join(", "))+". Showing results from successfully fetched scopes only. ",1)]),_:1})):E("",!0),n.value?(g(),V("div",$e,[(g(),V(R,null,F(3,t=>N(Q($),{key:t,skeleton:!0,class:"search-content__skeleton-card"})),64))])):E("",!0),a.value.length>0&&!n.value?(g(),V("div",Te,[c("div",ke,[w(" Found "+S(ee.value)+" "+S(i.value?"NOT":"")+' containing "',1),c("strong",null,S(f.value),1),e[11]||(e[11]=w('" ',-1))]),c("div",we,[(g(!0),V(R,null,F(a.value,(t,y,b,A)=>{const B=[t,f.value];if(A&&A.key===y&&ce(A,B))return A;const W=(g(),I(Q($),{key:y,class:"search-content__result-card"},{default:T(()=>[c("div",Me,[c("div",Ce,[c("div",xe,[N(X,{size:"small"},{default:T(()=>[w(S(Y(t)),1)]),_:2},1024),c("span",Ae,S(t.title),1)]),c("div",Ee,S(t.slug),1)]),N(X,{size:"medium",class:"search-content__match-count"},{default:T(()=>[w(S(D(t))+" "+S(C(D(t),"match","matches")),1)]),_:2},1024)]),c("div",Ve,[(g(!0),V(R,null,F(t.matches,(K,te)=>(g(),V("div",{key:te,class:"search-content__match-item"},[c("div",Ie,S(K.path),1),c("div",{class:"search-content__match-value",innerHTML:H(K.value,f.value)},null,8,Ne)]))),128))])]),_:2},1024));return W.memo=B,W},e,2),128))])])):E("",!0),h.value?(g(),V("div",Pe,[e[12]||(e[12]=c("h4",{class:"search-content__failed-items-title"},"⚠️ Failed to retrieve content",-1)),c("p",null,S(v.value),1)])):E("",!0)]),_:1},8,["description"]))}}),Re=de(Be,[["__scopeId","data-v-80d5282c"]]);export{Re as default};
