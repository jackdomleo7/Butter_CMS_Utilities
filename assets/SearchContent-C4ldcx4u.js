const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Card-Cxb7nHm2.js","assets/index-vL_oJ4Kp.js","assets/index-COcubFmy.css","assets/Card-C-UUnEqF.css"])))=>i.map(i=>d[i]);
import{d as te,u as se,o as _,c as V,w as $,a as B,b as M,e as m,T as ae,_ as ne,f as oe,g as re,h as G,i as A,j as J,t as S,k as N,F as P,r as R,l as Q,m as le,n as X,p as ce,q as ue,s as T,v as F,x as ie}from"./index-vL_oJ4Kp.js";import{g as he,a as fe,b as de,S as me,_ as pe}from"./collections-0vk8eUXM.js";function Y(o){return o.replace(/&nbsp;/gi," ").replace(/\u00A0/g," ").replace(/\s+/g," ")}function ve(o,v,l,c=100){const r=Math.max(0,v-c),u=Math.min(o.length,v+l+c);let s=o.substring(r,u);return r>0&&(s="..."+s),u<o.length&&(s=s+"..."),s}function b(o,v,l="",c=0,r=new WeakSet){const u=new Map;if(c>10||o==null)return u;if(typeof o=="object"&&!Array.isArray(o)){if(r.has(o))return u;r.add(o)}if(typeof o=="string"){const s=Y(o),h=Y(v),x=s.toLowerCase();let a=0,f=0;const p=[];for(;(a=x.indexOf(h,a))!==-1;)f++,p.length<3&&p.push(ve(s,a,h.length)),a+=h.length;f>0&&u.set(l||"root",{path:l||"root",snippets:p,count:f})}else if(typeof o=="number"||typeof o=="boolean"){const s=String(o);s.toLowerCase().includes(v)&&u.set(l||"root",{path:l||"root",snippets:[s],count:1})}else if(Array.isArray(o))o.forEach((s,h)=>{b(s,v,`${l}[${h}]`,c+1,r).forEach((a,f)=>{u.set(f,a)})});else if(typeof o=="object")for(const[s,h]of Object.entries(o))b(h,v,l?`${l}.${s}`:s,c+1,r).forEach((a,f)=>{u.set(f,a)});return u}async function ge(o,v,l,c,r,u,s=!1){const h=o.trim();if(!h)return{success:!0,results:[],totalItems:0};if(!u&&c.length===0&&r.length===0)return{success:!1,results:[],totalItems:null,error:"Please select at least one search scope (Blog, Page Type, or Collection Key)"};const x=h.toLowerCase(),a=[];let f=!1;try{const p=[],y=[];if(c.length>0)for(const i of c)try{(await he({token:v,pageType:i,preview:l})).forEach(C=>{y.push({data:C,sourceType:i})}),f=!0}catch(d){console.error(`Failed to fetch page type "${i}":`,d),a.push(`Page Type: ${i}`)}if(u)try{(await fe({token:v,preview:l})).forEach(d=>{y.push({data:d,sourceType:"Blog"})}),f=!0}catch(i){console.error("Failed to fetch Blog posts:",i),a.push("Blog")}if(r.length>0)for(const i of r)try{(await de({token:v,collectionType:i,preview:l})).forEach(C=>{y.push({data:C,sourceType:i})}),f=!0}catch(d){console.error(`Failed to fetch collection "${i}":`,d),a.push(`Collection: ${i}`)}if(!f)return{success:!1,results:[],totalItems:null,failedScopes:a,error:"Failed to fetch all selected scopes. Check console for details."};for(const{data:i,sourceType:d}of y){const C=b(i,x);if(C.size>0===!s){const k=i;if(s)p.push({title:k.name||k.title||k.slug||"Untitled",slug:k.slug||"N/A",sourceType:d,matches:[]});else{const E=Array.from(C.values()).map(g=>g.count>1?{path:`${g.path} (${g.count} occurrences)`,value:g.snippets[0]||"",count:g.count}:{path:g.path,value:g.snippets[0]||"",count:g.count}).filter(g=>g.value&&g.value.trim().length>0);E.length>0&&p.push({title:k.name||k.title||k.slug||"Untitled",slug:k.slug||"N/A",sourceType:d,matches:E})}}}return p.sort((i,d)=>i.slug.localeCompare(d.slug)),{success:!0,results:p,totalItems:y.length,failedScopes:a.length>0?a:void 0}}catch(p){return{success:!1,results:[],totalItems:null,failedScopes:a,error:p.message}}}const _e={class:"search-content__negation-section"},ye={key:4,class:"search-content__loading"},Se={key:5,id:"resultsContainer",class:"search-content__results-container"},$e={class:"search-content__summary","aria-live":"polite","aria-atomic":"true"},Te={class:"results-list"},ke={class:"search-content__result-header"},we={class:"search-content__result-header-left"},Me={class:"search-content__result-title-wrapper"},Ce={class:"search-content__result-title"},Ee={class:"search-content__result-slug"},xe={class:"search-content__matches-list"},Ae={class:"search-content__match-path"},Ne=["innerHTML"],Ie={key:6,class:"search-content__failed-items"},Ve=te({__name:"SearchContent",setup(o){const v=ce(()=>ue(()=>import("./Card-Cxb7nHm2.js"),__vite__mapDeps([0,1,2,3]))),l=se(),c=T(""),r=T(!1),u=T(!1),s=T(!1),h=T(""),x=T("info"),a=T([]),f=T(null),p=T(null),y=T([]),i=T(0),d=F(()=>a.value.length>0);function C(n,e,t){return n===1?e:t}function L(n){const e=document.createElement("div");return e.textContent=n,e.innerHTML}function k(n,e){const t=L(n),w=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),O=new RegExp(`(${w})`,"gi");return t.replace(O,"<mark>$1</mark>")}function z(){a.value=[],f.value=null,p.value=null,y.value=[],h.value="",c.value="",u.value=!1}function E(n,e="info",t=!1){h.value=n,x.value=e,s.value=t}function g(n){return n.sourceType==="Blog"?"Blog":`${n.sourceType}`}async function U(){const n=l.token,e=c.value.trim();if(a.value=[],f.value=null,p.value=null,y.value=[],h.value="",!n){E("Please enter your API token","error");return}if(u.value=!c.value,!u.value){s.value=!0,E("Searching...","info",!0);try{const t=await ge(e,n,l.includePreview,l.selectedScopes.pageTypes,l.selectedScopes.collectionKeys,l.selectedScopes.blog,r.value);if(!t.success){f.value=t.error,p.value=t.error,y.value=t.failedScopes||[],E(t.error,"error");return}i.value=t.totalItems,y.value=t.failedScopes||[],t.results.length===0?E(`No items ${r.value?"NOT":""} containing "${e}" found in ${t.totalItems} selected items`,"info",!1):(E(`Found ${t.results.length} items ${r.value?"NOT":""} containing "${e}" out of ${t.totalItems} total selected items`,"success",!1),a.value=t.results)}catch(t){E(`Error: ${t.message}`,"error")}finally{s.value=!1}}}const Z=F(()=>a.value.reduce((n,e)=>n+e.matches.reduce((t,w)=>t+(w.count||1),0),0)),H=F(()=>{const n=new Map;return a.value.forEach(e=>{const t=e.sourceType||"Unknown",w=e.matches.reduce((O,I)=>O+(I.count||1),0);n.set(t,(n.get(t)||0)+w)}),Array.from(n.entries()).map(([e,t])=>({scope:e,count:t})).sort((e,t)=>t.count-e.count)}),j=F(()=>{const n=Z.value;if(H.value.length===0)return"";const e=H.value.map(({scope:t,count:w})=>`${w} in ${t}`).join(", ");return`${n} ${C(n,"match","matches")}: ${e}`});function D(n){return n.matches.reduce((e,t)=>e+(t.count||1),0)}return(n,e)=>(_(),V(pe,{title:"Search Content",description:`Search through pages, blog posts, or collections for content ${r.value?"NOT":""} matching your search term. Results will highlight exactly where matches were ${r.value?"NOT":""} found.`},{default:$(()=>[B(me,{disabled:d.value,"aria-context":"search"},{legend:$(()=>[...e[4]||(e[4]=[M("Search Scopes",-1)])]),_:1},8,["disabled"]),m("div",_e,[e[5]||(e[5]=m("div",{class:"search-content__negation-label"},"Search Mode",-1)),B(ae,{id:"search-mode-toggle",modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=t=>r.value=t),disabled:d.value,"off-label":"Include matches (show items containing search term)","on-label":"Exclude matches (show items NOT containing search term)"},null,8,["modelValue","disabled"])]),B(ne,{id:"search-content-search-term",type:"text",required:!0,modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=t=>c.value=t),onKeypress:oe(U,["enter"])},re({label:$(()=>[e[6]||(e[6]=M("Search Term",-1))]),_:2},[u.value?{name:"error",fn:$(()=>[e[7]||(e[7]=M("Please enter a search term",-1))]),key:"0"}:void 0]),1032,["modelValue"]),!d.value&&!s.value?(_(),V(G,{key:0,onClick:U},{default:$(()=>[...e[8]||(e[8]=[M(" Search ",-1)])]),_:1})):A("",!0),d.value||h.value?(_(),V(G,{key:1,type:"reset",status:"tertiary",onClick:z},{default:$(()=>[...e[9]||(e[9]=[M(" Reset ",-1)])]),_:1})):A("",!0),h.value&&!s.value?(_(),V(J,{key:2,status:x.value,role:"alert"},{default:$(()=>[m("div",null,S(h.value),1)]),_:1},8,["status"])):A("",!0),y.value.length>0&&!s.value?(_(),V(J,{key:3,status:"warning"},{default:$(()=>[e[10]||(e[10]=m("strong",null,"Partial failure:",-1)),M(" Failed to fetch "+S(y.value.join(", "))+". Showing results from successfully fetched scopes only. ",1)]),_:1})):A("",!0),s.value?(_(),N("div",ye,[(_(),N(P,null,R(3,t=>B(Q(v),{key:t,skeleton:!0,class:"search-content__skeleton-card"})),64))])):A("",!0),a.value.length>0&&!s.value?(_(),N("div",Se,[m("div",$e,[M(" Found "+S(j.value)+" "+S(r.value?"NOT":"")+' containing "',1),m("strong",null,S(c.value),1),e[11]||(e[11]=M('" ',-1))]),m("div",Te,[(_(!0),N(P,null,R(a.value,(t,w,O,I)=>{const K=[t,c.value];if(I&&I.key===w&&le(I,K))return I;const W=(_(),V(Q(v),{key:w,class:"search-content__result-card"},{default:$(()=>[m("div",ke,[m("div",we,[m("div",Me,[B(X,{size:"small"},{default:$(()=>[M(S(g(t)),1)]),_:2},1024),m("span",Ce,S(t.title),1)]),m("div",Ee,S(t.slug),1)]),B(X,{size:"medium",class:"search-content__match-count"},{default:$(()=>[M(S(D(t))+" "+S(C(D(t),"match","matches")),1)]),_:2},1024)]),m("div",xe,[(_(!0),N(P,null,R(t.matches,(q,ee)=>(_(),N("div",{key:ee,class:"search-content__match-item"},[m("div",Ae,S(q.path),1),m("div",{class:"search-content__match-value",innerHTML:k(q.value,c.value)},null,8,Ne)]))),128))])]),_:2},1024));return W.memo=K,W},e,2),128))])])):A("",!0),f.value?(_(),N("div",Ie,[e[12]||(e[12]=m("h4",{class:"search-content__failed-items-title"},"⚠️ Failed to retrieve content",-1)),m("p",null,S(p.value),1)])):A("",!0)]),_:1},8,["description"]))}}),Fe=ie(Ve,[["__scopeId","data-v-0f1df59b"]]);export{Fe as default};
