const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Card-Cxb7nHm2.js","assets/index-vL_oJ4Kp.js","assets/index-COcubFmy.css","assets/Card-C-UUnEqF.css"])))=>i.map(i=>d[i]);
import{d as q,u as J,o as S,c as I,w as C,a as T,j as H,e as a,b as c,h as D,i as A,t as M,k as E,F as B,r as O,l as W,m as Q,n as z,p as X,q as Z,s as F,v as K,x as j}from"./index-vL_oJ4Kp.js";import{g as ee,a as te,b as se,S as oe,_ as ne}from"./collections-0vk8eUXM.js";const U=["mso-","paraid=","paraeid=","o:gfxdata=","o:p","w:st=","w:wrap=","w:wrap>","v:shapes=","v:imagedata","xml:namespace","xml:lang","data-ccp","data-contrast","data-font","data-listid","data-leveltext","data-defn-prop","figma=","figmeta=","data-figma","google-","docs-","data-pm","onclick=","onload=","onerror=","onmouseover=","onmouseout=","data-"];function ae(s){const g={};for(const i of s){const l=[];for(const u of s)u!==i&&u.startsWith(i)&&l.push(u);l.length>0&&(g[i]=l)}return g}const re=ae(U);function le(s){return s.replace(/&nbsp;/gi," ").replace(/\u00A0/g," ").replace(/\s+/g," ")}function ie(s,g,i,l=100){const u=Math.max(0,g-l),h=Math.min(s.length,g+i+l);let o=s.substring(u,h);return u>0&&(o="..."+o),h<s.length&&(o=o+"..."),o}function N(s,g,i="",l=0,u=new WeakSet,h){const o=new Map;if(l>10||s==null)return o;if(typeof s=="object"&&!Array.isArray(s)){if(u.has(s))return o;u.add(s)}if(typeof s=="string"){const d=le(s),f=d.toLowerCase(),_=g.toLowerCase();let p=0,t=0;const m=[],y=[],$=i||"root",w=h?.get($);for(;(p=f.indexOf(_,p))!==-1;){if(w&&w.has(p)){p+=_.length;continue}t++,y.push(p),m.length<3&&m.push(ie(d,p,_.length)),p+=_.length}t>0&&o.set($,{path:$,snippets:m,count:t,positions:y})}else if(typeof s=="number"||typeof s=="boolean"){const d=String(s),f=g.toLowerCase();d.toLowerCase().includes(f)&&o.set(i||"root",{path:i||"root",snippets:[d],count:1})}else if(Array.isArray(s))s.forEach((d,f)=>{N(d,g,`${i}[${f}]`,l+1,u,h).forEach((p,t)=>{o.set(t,p)})});else if(typeof s=="object")for(const[d,f]of Object.entries(s))N(f,g,i?`${i}.${d}`:d,l+1,u,h).forEach((p,t)=>{o.set(t,p)});return o}async function ue(s,g,i,l,u){if(!u&&i.length===0&&l.length===0)return{success:!1,results:[],totalIssues:0,patternsFound:[],error:"Please select at least one audit scope (Blog, Page Type, or Collection Key)"};const h=[];let o=!1;const d=new Set;try{const f=[],_=[];if(i.length>0)for(const t of i)try{(await ee({token:s,pageType:t,preview:g})).forEach(y=>{_.push({data:y,sourceType:t})}),o=!0}catch(m){console.error(`Failed to fetch page type "${t}":`,m),h.push(`Page Type: ${t}`)}if(u)try{(await te({token:s,preview:g})).forEach(m=>{_.push({data:m,sourceType:"Blog"})}),o=!0}catch(t){console.error("Failed to fetch Blog posts:",t),h.push("Blog")}if(l.length>0)for(const t of l)try{(await se({token:s,collectionType:t,preview:g})).forEach(y=>{_.push({data:y,sourceType:t})}),o=!0}catch(m){console.error(`Failed to fetch collection "${t}":`,m),h.push(`Collection: ${t}`)}if(!o)return{success:!1,results:[],totalIssues:0,patternsFound:[],failedScopes:h,error:"Failed to fetch all selected scopes. Check console for details."};let p=0;for(const{data:t,sourceType:m}of _){const y=t,$=[],w=new Map,L=new Map,P=Object.keys(re);for(const v of U){if(P.includes(v))continue;const e=N(t,v);e.size>0&&(w.set(v,e),e.forEach((n,k)=>{if(n.positions){L.has(k)||L.set(k,new Set);const R=L.get(k);n.positions.forEach(x=>R.add(x))}}))}for(const v of P){const r=N(t,v,"",0,new WeakSet,L);r.size>0&&w.set(v,r)}for(const[v,r]of w)r.size>0&&(d.add(v),r.forEach(e=>{const n=e.count;p+=n,$.push({pattern:v,path:e.count>1?`${e.path} (${e.count} occurrences)`:e.path,value:e.snippets[0]||"",count:e.count})}));$.length>0&&f.push({title:y.name||y.title||y.slug||"Untitled",slug:y.slug||"N/A",sourceType:m,issues:$.sort((v,r)=>{const e=v.pattern.localeCompare(r.pattern);return e!==0?e:v.path.localeCompare(r.path)})})}return f.sort((t,m)=>t.slug.localeCompare(m.slug)),{success:!0,results:f,totalIssues:p,patternsFound:Array.from(d).sort(),failedScopes:h.length>0?h:void 0}}catch(f){return{success:!1,results:[],totalIssues:0,patternsFound:[],failedScopes:h,error:f.message}}}const ce={key:4,class:"audit-content__loading"},de={key:5,id:"auditResultsContainer"},fe={class:"audit-content__summary","aria-live":"polite","aria-atomic":"true"},pe={class:"results-list"},ge={class:"audit-content__result-header"},he={class:"audit-content__result-header-left"},me={class:"audit-content__result-title-wrapper"},_e={class:"audit-content__result-title"},ve={class:"audit-content__result-slug"},ye={class:"audit-content__issues-list"},we={class:"audit-content__issue-header"},Se={class:"audit-content__issue-path"},ke=["innerHTML"],Ce={key:6,class:"audit-content__no-issues"},Me=q({__name:"AuditContent",setup(s){const g=X(()=>Z(()=>import("./Card-Cxb7nHm2.js"),__vite__mapDeps([0,1,2,3]))),i=J(),l=F(!1),u=F(""),h=F("info"),o=F([]),d=F([]),f=F(0),_=F([]),p=K(()=>o.value.length>0||u.value!=="");function t(r,e,n){return r===1?e:n}function m(r){const e=document.createElement("div");return e.textContent=r,e.innerHTML}function y(r,e){const n=m(r),k=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),R=new RegExp(`(${k})`,"gi");return n.replace(R,"<mark>$1</mark>")}function $(){o.value=[],d.value=[],u.value="",f.value=0,_.value=[]}function w(r,e="info",n=!1){u.value=r,h.value=e,l.value=n}async function L(){const r=i.token;if(o.value=[],d.value=[],u.value="",f.value=0,_.value=[],!r){w("Please enter your API token in the configuration above","error");return}l.value=!0,w("Auditing content...","info",!0);try{const e=await ue(r,i.includePreview,i.selectedScopes.pageTypes,i.selectedScopes.collectionKeys,i.selectedScopes.blog);if(!e.success){d.value=e.failedScopes||[],w(e.error,"error");return}f.value=e.totalIssues,_.value=e.patternsFound,d.value=e.failedScopes||[],e.results.length===0?w("No HTML bloat detected! Your content is clean.","success",!1):(w(`Found ${e.totalIssues} potential ${t(e.totalIssues,"issue","issues")} across ${e.results.length} ${t(e.results.length,"item","items")}`,"success",!1),o.value=e.results)}catch(e){w(`Error: ${e.message}`,"error")}finally{l.value=!1}}function P(r){return r.issues.reduce((e,n)=>e+n.count,0)}const v=K(()=>{if(o.value.length===0)return"";const r={};o.value.forEach(n=>{const k=P(n);r[n.sourceType]=(r[n.sourceType]||0)+k});const e=Object.entries(r).map(([n,k])=>`${k} in ${n}`).join(", ");return`${f.value} potential ${t(f.value,"issue","issues")}: ${e}`});return(r,e)=>(S(),I(ne,{title:"Audit HTML Bloat",description:"Detects bloated HTML attributes from design tools (Figma), word processors (Microsoft Office, Google Docs), rich text editors, and inline handlers that inflate page size. Review each finding to determine if it needs the attribute and value removed, or the entire element removed. Some issues flagged may be false positives depending on your content and use of attributes, so manual review is recommended."},{default:C(()=>[T(H,{status:"info",class:"audit-content__info"},{default:C(()=>[...e[2]||(e[2]=[a("strong",null,"What this checks:",-1),c(" HTML attributes from Microsoft Office (",-1),a("code",null,"mso-",-1),c(", ",-1),a("code",null,"data-contrast",-1),c(", ",-1),a("code",null,"paraid=",-1),c("), Figma (",-1),a("code",null,"figma=",-1),c(", ",-1),a("code",null,"data-figma-",-1),c("), Google Docs (",-1),a("code",null,"google-",-1),c("), rich text editors (",-1),a("code",null,"data-pm-slice",-1),c("), generic data attributes (",-1),a("code",null,"data-*",-1),c("), and inline handlers (",-1),a("code",null,"onclick=",-1),c("). These often appear when content is copied without proper formatting. ",-1),a("strong",null,"Prevention tip:",-1),c(" Always paste content without formatting (Ctrl+Shift+V). ",-1),a("strong",null,"Remediation:",-1),c(" Review surrounding HTML - you may need to remove just the attribute and value, or the entire element. ",-1)])]),_:1}),T(oe,{disabled:p.value,"aria-context":"audit"},{legend:C(()=>[...e[3]||(e[3]=[c("Audit Scopes",-1)])]),_:1},8,["disabled"]),!p.value&&!l.value?(S(),I(D,{key:0,onClick:L},{default:C(()=>[...e[4]||(e[4]=[c(" Run Audit ",-1)])]),_:1})):A("",!0),p.value||u.value?(S(),I(D,{key:1,type:"reset",status:"tertiary",onClick:$},{default:C(()=>[...e[5]||(e[5]=[c(" Reset ",-1)])]),_:1})):A("",!0),u.value&&!l.value?(S(),I(H,{key:2,status:h.value,role:"alert"},{default:C(()=>[a("div",null,M(u.value),1)]),_:1},8,["status"])):A("",!0),d.value.length>0&&!l.value?(S(),I(H,{key:3,status:"warning"},{default:C(()=>[e[6]||(e[6]=a("strong",null,"Partial failure:",-1)),c(" Failed to fetch "+M(d.value.join(", "))+". Showing results from successfully fetched scopes only. ",1)]),_:1})):A("",!0),l.value?(S(),E("div",ce,[(S(),E(B,null,O(3,n=>T(W(g),{key:n,skeleton:!0,class:"audit-content__skeleton-card"})),64))])):A("",!0),o.value.length>0&&!l.value?(S(),E("div",de,[a("div",fe,[e[7]||(e[7]=c(" Found ",-1)),a("strong",null,M(v.value),1),e[8]||(e[8]=c(". Patterns detected: ",-1)),a("strong",null,M(_.value.join(", ")),1)]),a("div",pe,[(S(!0),E(B,null,O(o.value,(n,k,R,x)=>{const G=[n];if(x&&x.key===k&&Q(x,G))return x;const V=(S(),I(W(g),{key:k,class:"audit-content__result-card"},{default:C(()=>[a("div",ge,[a("div",he,[a("div",me,[T(z,{size:"small"},{default:C(()=>[c(M(n.sourceType),1)]),_:2},1024),a("span",_e,M(n.title),1)]),a("div",ve,M(n.slug),1)]),T(z,{size:"medium",class:"audit-content__issue-count"},{default:C(()=>[c(M(P(n))+" "+M(t(P(n),"issue","issues")),1)]),_:2},1024)]),a("div",ye,[(S(!0),E(B,null,O(n.issues,(b,Y)=>(S(),E("div",{key:Y,class:"audit-content__issue-item"},[a("div",we,[T(z,{size:"small",class:"audit-content__issue-pattern"},{default:C(()=>[c(M(b.pattern),1)]),_:2},1024),a("span",Se,M(b.path),1)]),a("div",{class:"audit-content__issue-value",innerHTML:y(b.value,b.pattern)},null,8,ke)]))),128))])]),_:2},1024));return V.memo=G,V},e,0),128))])])):A("",!0),!l.value&&p.value&&o.value.length===0?(S(),E("div",Ce,[T(H,{status:"success"},{default:C(()=>[...e[9]||(e[9]=[a("strong",null,"Great!",-1),c(" No HTML bloat detected in the audited content. ",-1)])]),_:1})])):A("",!0)]),_:1}))}}),Ae=j(Me,[["__scopeId","data-v-63e7c8a8"]]);export{Ae as default};
