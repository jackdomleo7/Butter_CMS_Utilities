const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Card-DB7EXiiK.js","assets/index-BbjpQ4rS.js","assets/index-CtDfAwOd.css","assets/Card-C-UUnEqF.css"])))=>i.map(i=>d[i]);
import{d as se,u as ae,o as g,c as I,w as T,a as N,b as M,e as u,T as ne,f as oe,_ as re,g as le,h as G,i as E,j as J,t as S,k as V,F,r as R,l as Q,m as ce,n as X,p as ue,q as ie,s as k,v as O,x as de}from"./index-BbjpQ4rS.js";import{g as he,a as fe,b as me,n as z,c as pe,S as ve,_ as ge}from"./textNormalization-D1QAfY4U.js";function L(r,$,i="",m=0,d=new WeakSet){const p=new Map;if(m>10||r==null)return p;if(typeof r=="object"&&!Array.isArray(r)){if(d.has(r))return p;d.add(r)}if(typeof r=="string"){const n=z(r),h=z($),x=n.toLowerCase();let a=0,f=0;const v=[];for(;(a=x.indexOf(h,a))!==-1;)f++,v.length<3&&v.push(pe(n,a,h.length)),a+=h.length;f>0&&p.set(i||"root",{path:i||"root",snippets:v,count:f})}else if(typeof r=="number"||typeof r=="boolean"){const n=String(r);n.toLowerCase().includes($)&&p.set(i||"root",{path:i||"root",snippets:[n],count:1})}else if(Array.isArray(r))r.forEach((n,h)=>{L(n,$,`${i}[${h}]`,m+1,d).forEach((a,f)=>{p.set(f,a)})});else if(typeof r=="object")for(const[n,h]of Object.entries(r))L(h,$,i?`${i}.${n}`:n,m+1,d).forEach((a,f)=>{p.set(f,a)});return p}async function _e(r,$,i,m,d,p,n=!1){const h=r.trim();if(!h)return{success:!0,results:[],totalItems:0};if(!p&&m.length===0&&d.length===0)return{success:!1,results:[],totalItems:null,error:"Please select at least one search scope (Blog, Page Type, or Collection Key)"};const x=h.toLowerCase(),a=[];let f=!1;try{const v=[],_=[];if(m.length>0)for(const o of m)try{(await he({token:$,pageType:o,preview:i})).forEach(C=>{_.push({data:C,sourceType:o})}),f=!0}catch(l){console.error(`Failed to fetch page type "${o}":`,l),a.push(`Page Type: ${o}`)}if(p)try{(await fe({token:$,preview:i})).forEach(l=>{_.push({data:l,sourceType:"Blog"})}),f=!0}catch(o){console.error("Failed to fetch Blog posts:",o),a.push("Blog")}if(d.length>0)for(const o of d)try{(await me({token:$,collectionType:o,preview:i})).forEach(C=>{_.push({data:C,sourceType:o})}),f=!0}catch(l){console.error(`Failed to fetch collection "${o}":`,l),a.push(`Collection: ${o}`)}if(!f)return{success:!1,results:[],totalItems:null,failedScopes:a,error:"Failed to fetch all selected scopes. Check console for details."};for(const{data:o,sourceType:l}of _){const C=L(o,x);if(C.size>0===!n){const w=o;if(n)v.push({title:w.name||w.title||w.slug||"Untitled",slug:w.slug||"N/A",sourceType:l,matches:[]});else{const P=Array.from(C.values()).map(c=>c.count>1?{path:`${c.path} (${c.count} occurrences)`,value:c.snippets[0]||"",count:c.count}:{path:c.path,value:c.snippets[0]||"",count:c.count}).filter(c=>c.value&&c.value.trim().length>0);P.length>0&&v.push({title:w.name||w.title||w.slug||"Untitled",slug:w.slug||"N/A",sourceType:l,matches:P})}}}return v.sort((o,l)=>o.slug.localeCompare(l.slug)),{success:!0,results:v,totalItems:_.length,failedScopes:a.length>0?a:void 0}}catch(v){return{success:!1,results:[],totalItems:null,failedScopes:a,error:v.message}}}const ye={class:"search-content__negation-section"},Se={key:2,class:"search-content__loading"},$e={key:3,id:"resultsContainer",class:"search-content__results-container"},Te={class:"search-content__summary","aria-live":"polite","aria-atomic":"true"},ke={class:"results-list"},we={class:"search-content__result-header"},Me={class:"search-content__result-header-left"},Ce={class:"search-content__result-title-wrapper"},xe={class:"search-content__result-title"},Ae={class:"search-content__result-slug"},Ee={class:"search-content__matches-list"},Ve={class:"search-content__match-path"},Ie=["innerHTML"],Ne={key:4,class:"search-content__failed-items"},Pe=se({__name:"SearchContent",setup(r){const $=ue(()=>ie(()=>import("./Card-DB7EXiiK.js"),__vite__mapDeps([0,1,2,3]))),i=ae(),m=k(""),d=k(!1),p=k(!1),n=k(!1),h=k(""),x=k("info"),a=k([]),f=k(null),v=k(null),_=k([]),o=k(0),l=O(()=>a.value.length>0);function C(s,e,t){return s===1?e:t}function U(s){const e=document.createElement("div");return e.textContent=s,e.innerHTML}function w(s){const e={"'":["'","&apos;","&#39;","‘","’"],'"':['"',"&quot;","“","”"],"-":["-","&ndash;","&mdash;","–","—"],"£":["£","&pound;"],"€":["€","&euro;"],"&":["&","&amp;"],"<":["<","&lt;"],">":[">","&gt;"]," ":[" ","&nbsp;"," "]};return e[s]?`(?:${e[s].map(y=>y.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).join("|")})`:s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function H(s,e){const t=U(s),y=z(e.trim()),A=Array.from(y).map(w).join(""),B=new RegExp(`(${A})`,"gi");return t.replace(B,"<mark>$1</mark>")}function P(){a.value=[],f.value=null,v.value=null,_.value=[],h.value="",m.value="",p.value=!1}function c(s,e="info",t=!1){h.value=s,x.value=e,n.value=t}function Y(s){return s.sourceType==="Blog"?"Blog":`${s.sourceType}`}async function Z(){const s=i.token,e=m.value.trim();if(a.value=[],f.value=null,v.value=null,_.value=[],h.value="",!s){c("Please enter your API token","error");return}if(p.value=!m.value,!p.value){n.value=!0,c("Searching...","info",!0);try{const t=await _e(e,s,i.includePreview,i.selectedScopes.pageTypes,i.selectedScopes.collectionKeys,i.selectedScopes.blog,d.value);if(!t.success){f.value=t.error,v.value=t.error,_.value=t.failedScopes||[],c(t.error,"error");return}o.value=t.totalItems,_.value=t.failedScopes||[],t.results.length===0?c(`No items ${d.value?"NOT":""} containing "${e}" found in ${t.totalItems} selected items`,"info",!1):(c(`Found ${t.results.length} items ${d.value?"NOT":""} containing "${e}" out of ${t.totalItems} total selected items`,"success",!1),a.value=t.results)}catch(t){c(`Error: ${t.message}`,"error")}finally{n.value=!1}}}const j=O(()=>a.value.reduce((s,e)=>s+e.matches.reduce((t,y)=>t+(y.count||1),0),0)),q=O(()=>{const s=new Map;return a.value.forEach(e=>{const t=e.sourceType||"Unknown",y=e.matches.reduce((b,A)=>b+(A.count||1),0);s.set(t,(s.get(t)||0)+y)}),Array.from(s.entries()).map(([e,t])=>({scope:e,count:t})).sort((e,t)=>t.count-e.count)}),ee=O(()=>{const s=j.value;if(q.value.length===0)return"";const e=q.value.map(({scope:t,count:y})=>`${y} in ${t}`).join(", ");return`${s} ${C(s,"match","matches")}: ${e}`});function D(s){return s.matches.reduce((e,t)=>e+(t.count||1),0)}return(s,e)=>(g(),I(ge,{title:"Search Content",description:`Search through pages, blog posts, or collections for content ${d.value?"NOT":""} matching your search term. Results will highlight exactly where matches were ${d.value?"NOT":""} found.`},{default:T(()=>[N(ve,{disabled:l.value,"aria-context":"search"},{legend:T(()=>[...e[4]||(e[4]=[M("Search Scopes",-1)])]),_:1},8,["disabled"]),u("div",ye,[e[5]||(e[5]=u("div",{class:"search-content__negation-label"},"Search Mode",-1)),N(ne,{id:"search-mode-toggle",modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=t=>d.value=t),disabled:l.value,"off-label":"Include matches (show items containing search term)","on-label":"Exclude matches (show items NOT containing search term)"},null,8,["modelValue","disabled"])]),u("form",{class:"search-content__form",novalidate:"",onSubmit:oe(Z,["prevent"])},[N(re,{id:"search-content-search-term",type:"text",required:!0,disabled:l.value,modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=t=>m.value=t)},le({label:T(()=>[e[6]||(e[6]=M("Search Term",-1))]),_:2},[p.value?{name:"error",fn:T(()=>[e[7]||(e[7]=M("Please enter a search term",-1))]),key:"0"}:void 0]),1032,["disabled","modelValue"]),!l.value&&!n.value?(g(),I(G,{key:0,type:"submit"},{default:T(()=>[...e[8]||(e[8]=[M(" Search ",-1)])]),_:1})):E("",!0),l.value||h.value?(g(),I(G,{key:1,type:"reset",status:"tertiary",onClick:P},{default:T(()=>[...e[9]||(e[9]=[M(" Reset ",-1)])]),_:1})):E("",!0)],32),h.value&&!n.value?(g(),I(J,{key:0,status:x.value,role:"alert"},{default:T(()=>[u("div",null,S(h.value),1)]),_:1},8,["status"])):E("",!0),_.value.length>0&&!n.value?(g(),I(J,{key:1,status:"warning"},{default:T(()=>[e[10]||(e[10]=u("strong",null,"Partial failure:",-1)),M(" Failed to fetch "+S(_.value.join(", "))+". Showing results from successfully fetched scopes only. ",1)]),_:1})):E("",!0),n.value?(g(),V("div",Se,[(g(),V(F,null,R(3,t=>N(Q($),{key:t,skeleton:!0,class:"search-content__skeleton-card"})),64))])):E("",!0),a.value.length>0&&!n.value?(g(),V("div",$e,[u("div",Te,[M(" Found "+S(ee.value)+" "+S(d.value?"NOT":"")+' containing "',1),u("strong",null,S(m.value),1),e[11]||(e[11]=M('" ',-1))]),u("div",ke,[(g(!0),V(F,null,R(a.value,(t,y,b,A)=>{const B=[t,m.value];if(A&&A.key===y&&ce(A,B))return A;const W=(g(),I(Q($),{key:y,class:"search-content__result-card"},{default:T(()=>[u("div",we,[u("div",Me,[u("div",Ce,[N(X,{size:"small"},{default:T(()=>[M(S(Y(t)),1)]),_:2},1024),u("span",xe,S(t.title),1)]),u("div",Ae,S(t.slug),1)]),N(X,{size:"medium",class:"search-content__match-count"},{default:T(()=>[M(S(D(t))+" "+S(C(D(t),"match","matches")),1)]),_:2},1024)]),u("div",Ee,[(g(!0),V(F,null,R(t.matches,(K,te)=>(g(),V("div",{key:te,class:"search-content__match-item"},[u("div",Ve,S(K.path),1),u("div",{class:"search-content__match-value",innerHTML:H(K.value,m.value)},null,8,Ie)]))),128))])]),_:2},1024));return W.memo=B,W},e,2),128))])])):E("",!0),f.value?(g(),V("div",Ne,[e[12]||(e[12]=u("h4",{class:"search-content__failed-items-title"},"⚠️ Failed to retrieve content",-1)),u("p",null,S(v.value),1)])):E("",!0)]),_:1},8,["description"]))}}),be=de(Pe,[["__scopeId","data-v-d763faf2"]]);export{be as default};
